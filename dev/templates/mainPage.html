{% extends 'baseTemplates/basePage.html' %}
{% block title %}Главная страница{% endblock %}
{% block content %}
<!-- Секция пицц -->
<section id="pizzas" class="pizza-section">
    <h2 class="section-title">Пиццы</h2>
    <div class="good-grid">
        {% for pizza in pizzas %}
        <div class="good-card">
            <div class="good-image-wrapper">
                <div class="good-image-container">
                    <img src="{{ url_for('static', filename='img/' + pizza.image_path) }}"
                         alt="{{ pizza.name }}" class="good-image">
                </div>
            </div>
            <div class="good-details">
                <h2 class="good-title">{{ pizza.name }}</h2>
                <div class="good-ingredients">
                    <p>
                        {% for ingredient in pizza.ingredients %}
                        {{ ingredient.name }}{% if not loop.last %}, {% endif %}
                        {% endfor %}
                    </p>
                </div>
                <div class="good-footer">
                    <span class="good-price">от {{ pizza.price }} ₽</span>
                    <button class="add-to-cart"
                            data-name="{{ pizza.name }}"
                            data-base-price="{{ pizza.price }}"
                            data-image="{{ url_for('static', filename='img/' + pizza.image_path) }}"
                            data-ingredients="{% for ingredient in pizza.ingredients %}{{ ingredient.name }}{% if not loop.last %}, {% endif %}{% endfor %}">
                        Выбрать
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Модальное окно для пиццы -->
    <div id="pizzaModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="modal-body">
                <div class="pizza-image-container">
                    <img id="modalPizzaImage" src="" alt="Пицца" class="pizza-image">
                </div>
                <div class="pizza-options">
                    <h2 id="modalPizzaTitle"></h2>

                    <div class="size-options">
                        <h3>Размер</h3>
                        <div class="size-buttons">
                            <button class="size-btn active" data-size="25" data-price="699">25 см</button>
                            <button class="size-btn" data-size="30" data-price="899">30 см</button>
                            <button class="size-btn" data-size="35" data-price="1099">35 см</button>
                        </div>
                    </div>

                    <div class="dough-options">
                        <h3>Тесто</h3>
                        <div class="dough-buttons">
                            <button class="dough-btn active" data-dough="traditional">Традиционное</button>
                            <button class="dough-btn" data-dough="thin">Тонкое</button>
                        </div>
                    </div>

                    <div class="ingredients-options">
                        <h3>Добавить по вкусу</h3>
                        <div class="ingredients-grid">
                            {% for ingredient in ingredients %}
                            <div class="ingredient-card">
                                <label class="ingredient-item">
                                    <input type="checkbox" data-price="{{ingredient.price}}">
                                    <img src="{{ url_for('static', filename='img/' + ingredient.image_path) }}"
                                         alt="{{ingredient.name}}" class="ingredient-image">
                                    <span>{{ingredient.name}}</span>
                                    <span class="ingredient-price">{{ingredient.price}} ₽</span>
                                </label>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="modal-footer">
                        <div class="total-price">
                            Итого: <span id="modalTotalPrice"></span> ₽
                        </div>
                        <button id="addToCartFinal" class="add-to-cart">Добавить в корзину</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Секция напитков -->
<section id="drinks" class="drinks-section">
    <h2 class="section-title">Напитки</h2>
    <div class="good-grid">
        {% for drink in drinks %}
        <div class="good-card">
            <div class="good-image-wrapper">
                <div class="good-image-container">
                    <img src="{{ url_for('static', filename='img/' + drink.image_path) }}"
                         alt="{{ drink.name }}" class="good-image">
                </div>
            </div>
            <div class="good-details">
                <h2 class="good-title">{{ drink.name }}</h2>
                <div class="good-footer">
                    <span class="good-price">от {{ drink.price }} ₽</span>
                    <button class="add-to-cart">Выбрать</button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>

<!-- Секция десертов -->
<section id="desserts" class="desserts-section">
    <h2 class="section-title">Десерты</h2>
    <div class="good-grid">
        {% for desert in deserts %}
        <div class="good-card">
            <div class="good-image-wrapper">
                <div class="good-image-container">
                    <img src="{{ url_for('static', filename='img/' + desert.image_path) }}"
                         alt="{{ desert.name }}" class="good-image">
                </div>
            </div>
            <div class="good-details">
                <h2 class="good-title">{{ desert.name }}</h2>
                <div class="good-footer">
                    <span class="good-price">от {{ desert.price }} ₽</span>
                    <button class="add-to-cart">Выбрать</button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>

<style>
    .section-title {
        font-size: 24px;
        margin-left: 120px;
        margin-top: 50px;
        margin-bottom: 20px;
    }

    .good-grid {
        margin-left:100px;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(292px, 1fr));
        gap: 20px;
        justify-items: center;
    }

    .good-card {
    background: white;
    width: 292px;
    position: relative;
    border-radius: 8px;
    overflow: hidden;
    /* Убрали transition из карточки */
}

    .good-card:hover .good-image-container {
    transform: translateY(-10px); /* Анимация только для изображения */
}

    .good-image-wrapper {
        height: 302px;
        width: 292px;
        position: relative;
        margin-bottom: -10px;
    }

    .good-image-container {
    height: 292px;
    width: 292px;
    position: absolute;
    bottom: 0;
    transition: transform 0.3s ease; /* Добавили transition только для контейнера изображения */
}


    .good-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 15px 15px;
    }

    .good-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }

    .good-details {
        padding: 15px;
        text-align: center;
    }

    .good-title {
        font-size: 18px;
        text-align: left;
        margin: 0 0 10px 0;
    }

    .good-ingredients {
        margin: 10px 0;
        text-align: left;
    }

    .good-ingredients p {
        margin: 0;
        font-size: 13px;
        color: #666;
        line-height: 1.4;
    }

    .good-price {
        font-size: 16px;
        color: #e31837;
        margin: 15px 0;
        font-weight: bold;
    }

    .add-to-cart {
        background: #e31837;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 20px;
        cursor: pointer;
        font-weight: bold;
        width: 50%;
        transition: background 0.3s;
    }

    .add-to-cart:hover {
        background: #c0102c;
    }

    /* Стили для модального окна */
    .modal {
        display: none;
        position: fixed;
        z-index: 100;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .modal-content {
        background-color: #fff;
        margin: 5% auto;
        border-radius: 8px;
        width: 70%;
        max-width: 800px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        display: flex;
        transform: translateY(20px);
        transition: transform 0.3s ease-out;
    }

    .modal-body {
        display: flex;
        width: 100%;
    }

    .pizza-image-container {
        width: 40%;
        padding: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .pizza-image {
        width: 100%;
        height: auto;
        max-height: 350px;
        object-fit: contain;
        border-radius: 8px;
    }

    .pizza-options {
        width: 60%;
        padding: 20px;
    }

    .pizza-options h2{
        margin-bottom:15px;
    }

    .close {
        color: #aaa;
        position: absolute;
        right: 20px;
        top: 10px;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        z-index: 1;
    }

    .close:hover {
        color: #333;
    }

    .size-options, .dough-options, .ingredients-options {
        margin-bottom: 20px;
    }

    .size-buttons, .dough-buttons {
        display: flex;
        gap: 10px;
        margin-top: 10px;
    }

    .size-btn, .dough-btn {
        padding: 8px 15px;
        border: 1px solid #ddd;
        background: #f5f5f5;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
    }

    .size-btn.active, .dough-btn.active {
        background: #e31837;
        color: white;
        border-color: #e31837;
    }

    .ingredients-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin-top: 10px;
    }

    .ingredient-card {
        border: 1px solid #eee;
        border-radius: 8px;
        padding: 15px;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .ingredient-card:hover {
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .ingredient-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        cursor: pointer;
    }

    .ingredient-image {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 50%;
        margin-bottom: 8px;
        border: 2px solid transparent;
        transition: all 0.2s;
    }

    .ingredient-price {
        color: #e31837;
        font-weight: bold;
        margin-top: 5px;
        font-size: 14px;
    }

    input[type="checkbox"] {
        display: none;
    }

    input[type="checkbox"]:checked + .ingredient-image {
        border-color: #e31837;
        box-shadow: 0 0 0 2px #e31837;
    }

    .modal-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 20px;
        padding-top: 15px;
        border-top: 1px solid #eee;
    }

    .total-price {
        font-weight: bold;
        font-size: 18px;
    }

    #addToCartFinal {
        width: auto;
        padding: 10px 25px;
    }
</style>

<script>
    // Плавная прокрутка
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                window.scrollTo({
                    top: target.offsetTop - 50,
                    behavior: 'smooth'
                });
            }
        });
    });

    // Модальное окно для пиццы
    document.addEventListener('DOMContentLoaded', function() {
        const modal = document.getElementById('pizzaModal');
        const closeBtn = document.querySelector('.close');
        const addToCartButtons = document.querySelectorAll('.add-to-cart');
        const sizeButtons = document.querySelectorAll('.size-btn');
        const doughButtons = document.querySelectorAll('.dough-btn');
        const ingredientCheckboxes = document.querySelectorAll('.ingredient-card input[type="checkbox"]');
        const totalPriceElement = document.getElementById('modalTotalPrice');
        const modalPizzaImage = document.getElementById('modalPizzaImage');
        const modalContent = document.querySelector('.modal-content');

        let currentBasePrice = 699;
        let currentSize = '25';
        let currentDough = 'traditional';
        let extraIngredientsPrice = 0;

        // Анимация появления
        function fadeIn(element) {
            element.style.display = 'block';
            setTimeout(() => {
                element.style.opacity = '1';
                modalContent.style.transform = 'translateY(0)';
            }, 10);
        }

        // Анимация исчезновения
        function fadeOut(element) {
            element.style.opacity = '0';
            modalContent.style.transform = 'translateY(20px)';
            setTimeout(() => {
                element.style.display = 'none';
            }, 300);
        }

        // Открытие модального окна
        addToCartButtons.forEach(button => {
            button.addEventListener('click', function() {
                const pizzaName = this.dataset.name;
                const pizzaPrice = parseInt(this.dataset.basePrice);
                const pizzaImage = this.dataset.image;

                document.getElementById('modalPizzaTitle').textContent = pizzaName;
                modalPizzaImage.src = pizzaImage;
                modalPizzaImage.alt = pizzaName;

                document.querySelector('.size-btn[data-size="25"]').dataset.price = pizzaPrice;
                currentBasePrice = pizzaPrice;

                // Сброс предыдущих выборов
                sizeButtons.forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.size === '25') btn.classList.add('active');
                });

                doughButtons.forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.dough === 'traditional') btn.classList.add('active');
                });

                document.querySelectorAll('.ingredient-card input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = false;
                });

                currentSize = '25';
                currentDough = 'traditional';
                extraIngredientsPrice = 0;
                totalPriceElement.textContent = currentBasePrice;

                fadeIn(modal);
            });
        });

        // Закрытие модального окна
        closeBtn.addEventListener('click', function() {
            fadeOut(modal);
        });

        window.addEventListener('click', function(event) {
            if (event.target === modal) {
                fadeOut(modal);
            }
        });

        // Выбор размера пиццы
        sizeButtons.forEach(button => {
            button.addEventListener('click', function() {
                sizeButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                currentSize = this.dataset.size;
                currentBasePrice = parseInt(this.dataset.price);
                updateTotalPrice();
            });
        });

        // Выбор теста
        doughButtons.forEach(button => {
            button.addEventListener('click', function() {
                doughButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                currentDough = this.dataset.dough;
            });
        });

        // Выбор дополнительных ингредиентов
        ingredientCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                updateTotalPrice();
            });
        });

        // Обновление итоговой цены
        function updateTotalPrice() {
            extraIngredientsPrice = 0;
            ingredientCheckboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    extraIngredientsPrice += parseInt(checkbox.dataset.price);
                }
            });

            const totalPrice = currentBasePrice + extraIngredientsPrice;
            totalPriceElement.textContent = totalPrice;
        }

        // Добавление в корзину
        document.getElementById('addToCartFinal').addEventListener('click', function() {
            // Собираем выбранные ингредиенты
            const selectedIngredients = [];
            document.querySelectorAll('.ingredient-card input[type="checkbox"]:checked').forEach(checkbox => {
                selectedIngredients.push(checkbox.nextElementSibling.nextElementSibling.textContent);
            });

            alert(`Добавлено в корзину:\nПицца "${document.getElementById('modalPizzaTitle').textContent}"\nРазмер: ${currentSize} см\nТесто: ${currentDough === 'traditional' ? 'традиционное' : 'тонкое'}\nДоп. ингредиенты: ${selectedIngredients.join(', ') || 'нет'}\nЦена: ${totalPriceElement.textContent} ₽`);

            fadeOut(modal);
        });

        // Инициализация модального окна
        modal.style.display = 'none';
        modal.style.opacity = '0';
        modalContent.style.transform = 'translateY(20px)';
    });
</script>
{% endblock %}